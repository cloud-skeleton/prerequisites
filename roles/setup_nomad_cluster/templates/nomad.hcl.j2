data_dir  = "/opt/nomad/data"

{% if 'manager' in group_names %}
server {
  enabled          = true
  bootstrap_expect = {{ groups['manager'] | length }}
  server_join {
    retry_join = [
    {% for host in groups['manager'] %}
      "{{ hostvars[host].ansible_default_ipv4.address }}"{% if not loop.last %},{% endif %}

    {% endfor %}
    ]
  }
}
{% else %}
client {
  enabled = true
  server_join {
    retry_join = [
    {% for host in groups['manager'] %}
      "{{ hostvars[host].ansible_default_ipv4.address }}"{% if not loop.last %},{% endif %}

    {% endfor %}
    ]
  }
}
{% endif %}
